<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="author" content="Co-authored: Brian Wong, Justin Tsuchiyama, Tyler Luk">
    <meta name="description" content="Website to schedule stuff.">
    <link href="styles/styles.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">  
    <title>Scheduler</title>

    <!-- CALENDAR STUFF -->
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar-scheduler@5.6.0/main.min.css' rel='stylesheet' />
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.6.0/main.min.js'></script>

    <script>
      //document.addEventListener('DOMContentLoaded', function() {
        /* DEFAULT CALENDAR STYLE
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
          initialView: 'dayGridMonth'
        });
        calendar.render();*/

        /*var calendarID;
        var auth2 = gapi.auth2.getAuthInstance();
        if (auth2.isSignedIn.get()) {
          var profile = auth2.currentUser.get().getBasicProfile();
          calendarID = profile.getEmail();
        }
        console.log(calendarID);*/
        
        /*let calendar = new FullCalendar.Calendar(calendarEl, {
          googleCalendarApiKey: 'AIzaSyCtk-yPYtcMoxMn_7PasKZe3VtxDx4GckQ',
          initialView: 'dayGridMonth',
          events: {
            googleCalendarId: calendarID
          }
        });*/
      //});
    </script>
  </head>
  <body>

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
        https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-auth.js"></script>

    <!-- Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous"></script>

    <script>
      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      var firebaseConfig = {
        apiKey: "AIzaSyCtk-yPYtcMoxMn_7PasKZe3VtxDx4GckQ",
        authDomain: "schdlr-b3435.firebaseapp.com",
        projectId: "schdlr-b3435",
        storageBucket: "schdlr-b3435.appspot.com",
        messagingSenderId: "787536569268",
        appId: "1:787536569268:web:1f2966c2622f1a347a48e1",
        measurementId: "G-95FKY6HTYT"
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      var db = firebase.firestore();
      firebase.analytics();
      
    </script>
    <script src="scripts/User.js"></script>
    <script src="scripts/main.js"></script>


    <!-- Navbar -->
    <nav class="navbar navbar-inverse">
      <div class="container-fluid">
        <div class="navbar-header active">
          <a class="navbar-brand" href="#">Scheduler</a>
        </div>
        <ul class="nav navbar-nav">
          <li><a href="profile.html">Profile</a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li><a href="index.html" onclick="signOut()"><span class="glyphicon glyphicon-log-out"></span> Sign Out</a></li>
        </ul>

        <!-- Search Bar -->
        <div class="dropdown nav navbar-nav navbar-right">
          <button onclick="searchDropdown()" class="dropbtn">Search</button>
          <div id="myDropdown" class="dropdown-content">
            <input type="text" placeholder="Search.." id="myInput">
            <ul class="list-group" id="peopleList"></ul>
          </div>
        </div>


      </div>
    </nav>

    <!-- Content -->
    <div class="content">
      <button type="button" class="btn btn-primary btn-lg" id="create">
        <a href="#" style="color:white;">Create Event</a>
      </button>
      <hr>

      <!-- CALENDAR API BEGINS HERE -->

      <!--Add buttons to initiate auth sequence and sign out-->
      <button id="authorize_button" style="display: none;">Authorize</button>
      <button id="signout_button" style="display: none;">Sign Out</button>

      <pre id="content" style="white-space: pre-wrap;"></pre>

      <script type="text/javascript">
        // Client ID and API key from the Developer Console
        var CLIENT_ID = '787536569268-hbrvrsqbkq9cs1dvs38n0mdr4usq2qsm.apps.googleusercontent.com';
        var API_KEY = 'AIzaSyCtk-yPYtcMoxMn_7PasKZe3VtxDx4GckQ';

        // Array of API discovery doc URLs for APIs used by the quickstart
        var DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"];

        // Authorization scopes required by the API; multiple scopes can be
        // included, separated by spaces.
        var SCOPES = "https://www.googleapis.com/auth/calendar.readonly";

        var authorizeButton = document.getElementById('authorize_button');
        var signoutButton = document.getElementById('signout_button');

        /**
         *  On load, called to load the auth2 library and API client library.
         */
        /*function handleClientLoad() {
          gapi.load('client:auth2', initClient);
        }

        var auth2;
        **
         *  Initializes the API client library and sets up sign-in state
         *  listeners.
         *
        function initClient() {
          auth2 = gapi.client.init({
            apiKey: API_KEY,
            clientId: CLIENT_ID,
            discoveryDocs: DISCOVERY_DOCS,
            scope: SCOPES
          }).then(function () {
            // Listen for sign-in state changes.
            gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

            // Handle the initial sign-in state.
            updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
            authorizeButton.onclick = handleAuthClick;
            signoutButton.onclick = handleSignoutClick;

            auth2.then(checkForLoggerInUser, onFailure);
          }, function(error) {
            appendPre(JSON.stringify(error, null, 2));
          });
        }*/

        var auth2;
        var initClient = function() {
          gapi.load('auth2', function(){
            /**
             * Retrieve the singleton for the GoogleAuth library and set up the
             * client.
             */
            auth2 = gapi.auth2.init({
              apiKey: API_KEY,
              clientId: CLIENT_ID,
              discoveryDocs: DISCOVERY_DOCS,
              scope: SCOPES
            });

            // Called once auth2 has finished initializing
            auth2.then(checkForLoggedInUser, onFailure);
          });
        };

        function onFailure() {
          console.log("UR A FAILURE, plz");
        }

        function checkForLoggedInUser() {
          var user = auth2.currentUser.get();
          var profile = user.getBasicProfile();
          console.log('Email: ' + profile.getEmail());
        }
        /**
         *  Called when the signed in status changes, to update the UI
         *  appropriately. After a sign-in, the API is called.
         */
        function updateSigninStatus(isSignedIn) {
          if (isSignedIn) {
            authorizeButton.style.display = 'none';
            signoutButton.style.display = 'block';
            listUpcomingEvents();
          } else {
            authorizeButton.style.display = 'block';
            signoutButton.style.display = 'none';
          }
        }

        /**
         *  Sign in the user upon button click.
         */
        function handleAuthClick(event) {
          gapi.auth2.getAuthInstance().signIn();
        }

        /**
         *  Sign out the user upon button click.
         */
        function handleSignoutClick(event) {
          gapi.auth2.getAuthInstance().signOut();
        }

        /**
         * Append a pre element to the body containing the given message
         * as its text node. Used to display the results of the API call.
         *
         * @param {string} message Text to be placed in pre element.
         */
        function appendPre(message) {
          var pre = document.getElementById('content');
          var textContent = document.createTextNode(message + '\n');
          pre.appendChild(textContent);
        }

        /**
         * Print the summary and start datetime/date of the next ten events in
         * the authorized user's calendar. If no events are found an
         * appropriate message is printed.
         */
        function listUpcomingEvents() {
          gapi.client.calendar.events.list({
            'calendarId': 'primary',
            'timeMin': (new Date()).toISOString(),
            'showDeleted': false,
            'singleEvents': true,
            'maxResults': 10,
            'orderBy': 'startTime'
          }).then(function(response) {
            var events = response.result.items;
            appendPre('Upcoming events:');

            if (events.length > 0) {
              for (i = 0; i < events.length; i++) {
                var event = events[i];
                var when = event.start.dateTime;
                if (!when) {
                  when = event.start.date;
                }
                appendPre(event.summary + ' (' + when + ')')
              }
            } else {
              appendPre('No upcoming events found.');
            }
          });
        }

      </script>

      <script async defer src="https://apis.google.com/js/api.js"
        onload="this.onload=function(){};initClient()"
        onreadystatechange="if (this.readyState === 'complete') this.onload()">
      </script>

      <!-- CALENDAR STARTS HERE -->
      <div id='calendar'></div>
          

    </div>

    <footer>
      <p>©Copyright 2050 by nobody. All rights reversed.</p>
    </footer>
  </body>
</html> 
